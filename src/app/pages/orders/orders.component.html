<div class="row">
  <div class="col-md-4">
    <h2>Orders</h2>

    <div *ngIf="loadingStudents" class="alert alert-info">
      Loading students...
    </div>

    <div class="mb-3">
      <label class="form-label">Select Student</label>
      <select
        class="form-select"
        [(ngModel)]="selectedStudentId"
        name="selectedStudentId"
        (change)="onSelectStudent()"
      >
        <option [ngValue]="null">-- Choose a student --</option>
        <option *ngFor="let s of students" [ngValue]="s.studentId">
          {{ s.name }} (Grade {{ s.grade }}, {{ s.school }})
        </option>
      </select>
    </div>

    <div *ngIf="error" class="alert alert-danger">{{ error }}</div>
  </div>

  <div class="col-md-8" *ngIf="selectedStudentId">
    <div class="card shadow-sm">
      <div class="card-body">
        <h3>Orders for selected student</h3>

        <div *ngIf="loadingOrders" class="alert alert-info">
          Loading orders...
        </div>

        <table
          class="table table-striped table-sm"
          *ngIf="orders.length > 0 && !loadingOrders"
        >
          <thead>
            <tr>
              <th>ID</th>
              <th>Total</th>
              <th>Status</th>
              <th>Created</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let o of orders">
              <td>{{ o.orderId }}</td>
              <td>{{ o.total | currency }}</td>
              <td>
                <span
                  class="badge"
                  [ngClass]="{
                    'bg-warning text-dark': o.status === 'pending',
                    'bg-success': o.status === 'paid'
                  }"
                >
                  {{ o.status }}
                </span>
              </td>
              <td>{{ o.creationDateTime || "â€”" }}</td>
            </tr>
          </tbody>
        </table>

        <p *ngIf="!loadingOrders && orders.length === 0" class="text-muted">
          No orders yet for this student.
        </p>

        <hr />

        <h4>Add Order</h4>
        <form #orderForm="ngForm" (ngSubmit)="onSubmitOrder(orderForm)">
          <div class="mb-3">
            <label class="form-label">Total</label>
            <input
              type="number"
              class="form-control"
              name="total"
              [(ngModel)]="newOrder.total"
              min="0"
              step="0.01"
              required
            />
          </div>

          <div class="mb-3">
            <label class="form-label">Status</label>
            <select
              class="form-select"
              name="status"
              [(ngModel)]="newOrder.status"
              required
            >
              <option value="pending">Pending</option>
              <option value="paid">Paid</option>
            </select>
          </div>

          <button
            class="btn btn-primary"
            type="submit"
            [disabled]="orderForm.invalid || savingOrder"
          >
            {{ savingOrder ? "Saving..." : "Create Order" }}
          </button>
        </form>
      </div>
    </div>
  </div>

  <div class="col-md-8" *ngIf="!selectedStudentId">
    <p class="text-muted mt-4">Select a student to view and create orders.</p>
  </div>
</div>
